"use strict";(()=>{var e={};e.id=945,e.ids=[945],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6839:(e,t,n)=>{n.r(t),n.d(t,{headerHooks:()=>g,originalPathname:()=>v,patchFetch:()=>w,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>f,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>p});var r={};n.r(r),n.d(r,{POST:()=>h});var a=n(5419),o=n(9108),l=n(9678),i=n(8070),u=n(8093),s=n(7828);async function h(e){try{let{code:t,action:n}=await e.json(),r=await u._.room.findUnique({where:{code:t}});if(!r)return i.Z.json({error:"Room not found"},{status:404});let a={},o=JSON.parse(r.bracketState),l=o.rounds[r.currentRound],h=l.matches[r.currentMatch];if("START"===n)a.status="VOTING";else if("REVEAL"===n){a.status="REVEAL";let e=await u._.vote.findMany({where:{matchId:h.id}}),t=e.filter(e=>e.choice===h.nameA).length,n=e.filter(e=>e.choice===h.nameB).length,l=t>=n?h.nameA:h.nameB??h.nameA;h.votesA=t,h.votesB=n,h.winner=l,o.rounds[r.currentRound].matches[r.currentMatch]=h,a.bracketState=JSON.stringify(o)}else if("NEXT"===n){if(r.currentMatch<l.matches.length-1)a.currentMatch=r.currentMatch+1,a.status="VOTING";else{if(!l.matches.every(e=>e.winner))return i.Z.json({error:"Round not complete"},{status:400});{let e=(0,s.L)(o);e.finalWinner?a.status="FINISHED":(a.currentRound=r.currentRound+1,a.currentMatch=0,a.status="VOTING"),a.bracketState=JSON.stringify(e)}}}let c=await u._.room.update({where:{code:t},data:a});return i.Z.json(c)}catch(e){return console.error("Control action failed:",e),i.Z.json({error:"Control action failed"},{status:500})}}let c=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/live/control/route",pathname:"/api/live/control",filename:"route",bundlePath:"app/api/live/control/route"},resolvedPagePath:"/Users/qaneahmed/PregLife/preglife/baby-name-deathmatch/app/api/live/control/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:d,staticGenerationAsyncStorage:m,serverHooks:f,headerHooks:g,staticGenerationBailout:p}=c,v="/api/live/control/route";function w(){return(0,l.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:m})}},8093:(e,t,n)=>{n.d(t,{_:()=>a});let r=require("@prisma/client"),a=global.prisma||new r.PrismaClient({log:["query"]})},7828:(e,t,n)=>{function r(e){var t;let n=e.map(e=>e.trim()).filter(Boolean).slice(0,16);if(n.length<2)throw Error("At least two names are required.");return(t=n.length)>0&&(t&t-1)==0?function(e){let t=e.length,n=(2===t?[1,2]:4===t?[1,4,2,3]:8===t?[1,8,4,5,2,7,3,6]:16===t?[1,16,8,9,4,13,5,12,2,15,7,10,3,14,6,11]:Array.from({length:t},(e,t)=>t+1)).map(t=>e[t-1]),r=[],a=o(0,Math.log2(t)),l=[];for(let e=0;e<n.length;e+=2)l.push({id:`r0-m${l.length}`,round:0,roundLabel:a,matchIndex:l.length,nameA:n[e],nameB:n[e+1],votesA:0,votesB:0,winner:null});return r.push({round:0,roundLabel:a,matches:l}),{rounds:r,finalWinner:null}}(n):function(e){let t=e.length,n=Math.pow(2,Math.ceil(Math.log2(t))),r=n-t,a=t-r,l=e.slice(0,a),i=e.slice(a),u=[],s=[],h=o(0,Math.log2(n));for(let e=0;e<l.length;e+=2)s.push({id:`r0-m${s.length}`,round:0,roundLabel:h,matchIndex:s.length,nameA:l[e],nameB:l[e+1],votesA:0,votesB:0,winner:null});for(let e of i)s.push({id:`r0-m${s.length}`,round:0,roundLabel:h,matchIndex:s.length,nameA:e,nameB:null,votesA:1,votesB:0,winner:e});return u.push({round:0,roundLabel:h,matches:s}),{rounds:u,finalWinner:null}}(n)}function a(e){let{rounds:t}=e,n=t[t.length-1];if(!n.matches.every(e=>null!==e.winner))return e;let r=n.matches.map(e=>e.winner).filter(e=>null!==e);if(1===r.length)return{...e,finalWinner:r[0]};let a=n.round+1,l=o(a,Math.ceil(Math.log2(r.length))+n.round),i=[];for(let e=0;e<r.length;e+=2){let t=r[e],n=r[e+1]||null;n?i.push({id:`r${a}-m${i.length}`,round:a,roundLabel:l,matchIndex:i.length,nameA:t,nameB:n,votesA:0,votesB:0,winner:null}):i.push({id:`r${a}-m${i.length}`,round:a,roundLabel:l,matchIndex:i.length,nameA:t,nameB:null,votesA:1,votesB:0,winner:t})}return{rounds:[...t,{round:a,roundLabel:l,matches:i}],finalWinner:null}}function o(e,t){let n=t-e;return 0===n?"Final":1===n?"Semi-Finals":2===n?"Quarter-Finals":3===n?"Round of 16":`Round ${e+1}`}n.d(t,{C:()=>r,L:()=>a})}};var t=require("../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[638,206],()=>n(6839));module.exports=r})();